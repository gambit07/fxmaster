/* =========================================================
   FXMaster — Particle Effects Config Window (full CSS)
   ========================================================= */

/* sensible defaults (overridden via JS when restoring autosize) */
:root {
  --fxmaster-max-height: 90vh;
  --fxmaster-radius: 6px;
}

/* ——— Base app window: allow natural height growth ——— */
.fxmaster-app.window-app,
.fxmaster-app.ui-dialog {
  height: auto !important;
  min-height: 0 !important; /* prevent residual min-height from forcing scroll */
  max-height: var(--fxmaster-max-height) !important;
  overflow: visible !important;
}

/* inner content scrolls (not the shell) */
.fxmaster-app .window-content {
  height: auto !important;
  min-height: 0 !important;
  max-height: var(--fxmaster-max-height) !important;
  overflow-y: auto !important;
  overflow-x: hidden !important;
}

/* ——— “Autosize” switch: wipes inline sizes left by jQuery UI resize ———
   Add/Remove .fxm-autosize on the .window-app from JS when rows open/close. */
.window-app.fxm-autosize {
  height: auto !important;
  min-height: 0 !important;
  max-height: var(--fxmaster-max-height) !important;
  overflow: visible !important;
}
.window-app.fxm-autosize .window-content {
  height: auto !important;
  min-height: 0 !important;
  max-height: var(--fxmaster-max-height) !important;
  overflow-y: auto !important;
  overflow-x: hidden !important;
}
/* while resizing, keep auto; jQuery UI adds these classes during drag */
.window-app.fxm-autosize.ui-resizable,
.window-app.fxm-autosize.ui-resizable-resizing {
  height: auto !important;
  min-height: 0 !important;
}

/* ——— App root (id) ——— */
#particle-effects-config {
  height: auto;
  max-height: var(--fxmaster-max-height);
  overflow: visible;
}
#particle-effects-config .window-content,
.ui-dialog.fxmaster-app .ui-dialog-content {
  height: auto;
  min-height: 0; /* ensure no inherited min-height forces scrollbars */
  max-height: var(--fxmaster-max-height);
  overflow-y: auto;
  overflow-x: hidden;
}

/* ====== Main grid ====== */
.fxmaster-particles-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1rem;
  padding: 1rem;
  box-sizing: border-box;
  height: auto;
  max-height: var(--fxmaster-max-height);
  overflow: visible;
}

/* Column (left/right) wrappers that can scroll when needed */
.fxmaster-particles-group-wrapper {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  flex: 1 1 auto;
  min-height: 0;
  max-height: var(--fxmaster-max-height);
  overflow-y: auto;
  padding-right: 0.25rem;
}

/* When any row inside a column is open, let the column grow and let the window absorb it.
   Modern browsers: :has(). For broader support, toggle .fxm-column-open from JS. */
.fxmaster-particles-group-wrapper:has(.fxmaster-particles-row.open) {
  max-height: none;
  overflow: visible;
}
/* Fallback class (toggle from JS alongside expand): */
.fxmaster-particles-group-wrapper.fxm-column-open {
  max-height: none;
  overflow: visible;
}

/* ====== Groups / Rows ====== */
.fxmaster-particles-group {
  cursor: pointer;
}

/* Open-state boxing */
#particle-effects-config .fxmaster-particles-row.open {
  border: 1px solid var(--color-warm-2);
  border-bottom: none;
  border-radius: var(--fxmaster-radius) var(--fxmaster-radius) 0 0;
}
#particle-effects-config .fxmaster-particles-row.open + .fxmaster-particle-expand {
  border: 1px solid var(--color-warm-2);
  border-top: none;
  border-radius: 0 0 var(--fxmaster-radius) var(--fxmaster-radius);
  margin-bottom: 0.25rem;
}

/* Expand panels: never scroll internally; let the column/window grow */
#particle-effects-config .fxmaster-particle-expand,
#particle-effects-config .fxmaster-particles-group-expand {
  max-height: none;
  overflow: visible;
}

/* ====== Param grid ====== */
.fxmaster-particle-params {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 0.75rem 1rem;
}
.fxmaster-particle-params label {
  display: flex;
  flex-direction: column;
  font-size: var(--font-size-12);
  gap: 0.25rem;
}

/* ====== Arrow offsets ====== */
.fxmaster-arrow-group {
  right: 0.5rem;
}
.fxmaster-arrow-row {
  right: 3.2rem;
}

/* ====== Misc ====== */
/* Resist accidental clipping anywhere in the FXMaster app window */
.fxmaster-app * {
  overflow-anchor: none;
}
